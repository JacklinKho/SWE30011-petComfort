<!DOCTYPE html>
<html>
    <head>
        <title>Dog Room</title>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}" />
    </head>
    <body>
        <div class="container2">
            <img
                src="../static/images/dog2.png" alt="Dog room" class="title-background" />
            <h1 class="title">Dog Room</h1>
			<!-- pass the last_petCount here -->
			<h2 class="subtitle">Total pet inside: {{ last_petCount }}</h2>
            <div class="button-container">
                <button id="openModalBtn" class="btn">View Room</button>
            </div>
            <div id="chartModal" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<img id="capturedImage" src="" alt="Picam Image" />				
				</div>
			</div>

            {% for row in data %}
            <div class="data-container">
                <div class="data-row">
					<div class="data-label">Date:</div>
					<div class="data-value">{{ row["time"].strftime('%Y-%m-%d') }}</div>
				</div>
				<div class="data-row">
					<div class="data-label">Time:</div>
					<div class="data-value">{{ row["time"].strftime('%H:%M:%S') }}</div>
				</div>
                <div class="data-row">
                    <div class="data-label">Humidity:</div>
                    <div class="data-value">{{ row["humidity"] }}</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Temperature:</div>
                    <div class="data-value"> {{ row["temperature_C"] }}°C / {{ row["temperature_F"] }}°F </div>
                </div>
                <div class="data-row">
                    <div class="data-label">Light:</div>
                    <div class="data-value">{% if row["lightState"] == 0 %} OFF {% else %} ON {% endif %}</div>
                </div>
                <div class="data-row">
					<div class="data-label">Fan:</div>
					<div class="data-value">{% if row["fanState"] == 0 %} OFF {% else %} ON {% endif %}</div>
					<div class="data-label data-label-fan-speed">Fan Speed:</div>
					<div class="data-value">{{ row["fanSpeed"] }}</div>
				</div>
                <div class="data-row">
                    <div class="data-label">Window:</div>
					<div class="data-value">{% if row["windowState"] == 0 %} OFF {% else %} ON {% endif %}</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Dust Level:</div>
                    <img src="{{ url_for('static', filename='dogRoom/chart/chart_' + row['dogTableID']|string + '.png') }}" alt="Chart Image" />
                </div>
            </div>
            {% endfor %}
        </div>

        <script>
			// JavaScript to handle modal functionality
			var modal = document.getElementById("chartModal");
			var btn = document.getElementById("openModalBtn");
			var span = document.getElementsByClassName("close")[0];

			btn.onclick = function() {
				modal.style.display = "block";
				fetch("/capture-dog-image")
					.then(response => response.json())
					.then(data => {
						var img = document.getElementById("capturedImage");
						img.src = data.image_path;
						modal.style.display = "block";
					})
					.catch(error => console.error("Error:", error));
			}

			span.onclick = function() {
				modal.style.display = "none";
			}

			window.onclick = function(event) {
				if (event.target == modal) {
					modal.style.display = "none";
				}
			}
		</script>
    </body>
</html>